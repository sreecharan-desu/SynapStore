generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}


model User {
  id           String    @id @default(uuid())
  username     String    @unique
  email        String    @unique
  password     String
  imageUrl     String?
  OtpCode      String?
  otpExpiresAt DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
}

// ---------------------------------------------
//  Doctor
// ---------------------------------------------

model Doctor {
  physID Int     @id @default(autoincrement())
  name   String
  address String
  phone   String

  prescriptions Prescription[]
}

// ---------------------------------------------
//  Supplier
// ---------------------------------------------

model Supplier {
  supID  Int    @id @default(autoincrement())
  name   String
  address String
  phone   String

  drugs Drugs[]
}

// ---------------------------------------------
//  Drugs
// ---------------------------------------------

model Drugs {
  NDC           Int      @id
  brandName     String
  genericName   String
  dosage        Int
  expDate       String
  supID         Int
  purchasePrice Float
  sellPrice     Float

  supplier Supplier @relation(fields: [supID], references: [supID])

  prescriptions Prescription[]
}

// ---------------------------------------------
//  Insurance
// ---------------------------------------------

model Insurance {
  name   String @id
  phone  String
  coPay  String   // Yes / No stored as text

  patients Patient[]
}

// ---------------------------------------------
//  Patient
// ---------------------------------------------

model Patient {
  patientID Int     @id @default(autoincrement())
  firstName String
  lastName  String
  birthdate String
  address   String
  phone     String
  gender    String?
  insurance String?

  insuranceProvider Insurance? @relation(fields: [insurance], references: [name])

  prescriptions Prescription[]
}

// ---------------------------------------------
//  Prescriptions
// ---------------------------------------------

model Prescription {
  // No explicit primary key in CSV
  // We create one for Prisma compatibility
  id        Int @id @default(autoincrement())

  patientID Int
  physID    Int
  NDC       Int

  qty     Int
  days    Int
  refills Int
  status  String?

  patient Patient @relation(fields: [patientID], references: [patientID])
  doctor  Doctor  @relation(fields: [physID], references: [physID])
  drug    Drugs   @relation(fields: [NDC], references: [NDC])

  @@index([patientID])
  @@index([physID])
  @@index([NDC])
}